

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Building the documentation &mdash; SoHAPPy 0.9 beta documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=88ef157a"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            SoHAPPy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Building the documentation</a></li>
<li><a class="reference internal" href="#todo-list">Todo list</a><ul>
<li><a class="reference internal" href="#various">Various</a></li>
<li><a class="reference internal" href="#masking-the-first-dataset-in-a-stacked-datasets">Masking the first dataset in a stacked Datasets</a></li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SoHAPPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Building the documentation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/developer.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="building-the-documentation">
<h1>Building the documentation<a class="headerlink" href="#building-the-documentation" title="Link to this heading"></a></h1>
<p>Install Sphinx and the extensions.
Extensions should be installed separately. As an example the <cite>automodapi</cite>,
that creates an output superior to the autodoc standard package, has to be
installed (see here):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>conda install -c conda-forge sphinx
conda install -c conda-forge sphinx-automodapi
conda install –c conda-forge nbsphinx
conda install -c conda-forge recommonmark
conda install -c conda-forge numpydoc
conda install -c conda-forge sphinx_rtd_theme

make html
</pre></div>
</div>
</section>
<section id="todo-list">
<h1>Todo list<a class="headerlink" href="#todo-list" title="Link to this heading"></a></h1>
<section id="various">
<h2>Various<a class="headerlink" href="#various" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Stack the prompt with the afterglow</p></li>
<li><p>Can we suppress simulation for large S and B. yes, but how well ?</p></li>
<li><p>Inject Fermi data and IRF, compute response</p></li>
<li><p>Interpolate time counts within the time slices;</p></li>
<li><p>Use papermill to have the jupyter notebbok automatically run;</p></li>
<li><p>Use jupyter nbconvert to convert executed jupyter notebook into html files;</p></li>
</ul>
</section>
<section id="masking-the-first-dataset-in-a-stacked-datasets">
<h2>Masking the first dataset in a stacked Datasets<a class="headerlink" href="#masking-the-first-dataset-in-a-stacked-datasets" title="Link to this heading"></a></h2>
<p><em>From a Gammapy Slack conversation with &#64;adonath, Jan. 2021</em></p>
<p>By default the <code class="xref py py-obj docutils literal notranslate"><span class="pre">mask_safe</span></code> is not applied to a dataset so that it can be changed for different analysis with the same data.</p>
<p>When stacking a set of Dataset, all datasets except the first one are masked.
Up to gammapy 0.17 at least, in order to have the mask applied it had to be done “by hand” with the following function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_masked_dataset</span><span class="p">(</span><span class="n">ds0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a trick to get a masked datset from a dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ds0 : Dataset object</span>
<span class="sd">                The original complete unmasked dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        masked_dataset : Dataset object</span>
<span class="sd">                The original dataset with masking applied.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;dataset_tools/get_maked_dataset(ds) : masking disabled&quot;)</span>
        <span class="c1"># return ds0</span>

        <span class="n">e_true</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">aeff</span><span class="o">.</span><span class="n">energy</span><span class="o">.</span><span class="n">edges</span>
        <span class="n">e_reco</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span>
        <span class="n">region</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">region</span>
        <span class="n">masked_dataset</span> <span class="o">=</span> <span class="n">SpectrumDataset</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">e_true</span><span class="o">=</span><span class="n">e_true</span><span class="p">,</span> <span class="n">e_reco</span><span class="o">=</span><span class="n">e_reco</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">ds0</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span>
        <span class="n">masked_dataset</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">models</span>
        <span class="n">masked_dataset</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">ds0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">masked_dataset</span>
</pre></div>
</div>
<p>This functionnality is planned to be released soon as <code class="xref py py-func docutils literal notranslate"><span class="pre">to_masked()</span></code> in <cite>dataset/map.py</cite> and should replace the existing function.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Th. Stolarczyk.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>