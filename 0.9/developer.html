<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Building the documentation &mdash; SoHAPPy 0.9 beta documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Dp" href="api/utilities.Dp.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> SoHAPPy
          </a>
              <div class="version">
                0.9
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">How to run it</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="sohappy.html">How it works ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration file</a></li>
<li class="toctree-l1"><a class="reference internal" href="irf.html">Instrument response functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_format.html">Input file format</a></li>
<li class="toctree-l1"><a class="reference internal" href="production.html">Running large simulations and analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Concepts and classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="grb.html">Astrophysical objects (GRB)</a></li>
<li class="toctree-l1"><a class="reference internal" href="time_slice.html">Time slices and slots</a></li>
<li class="toctree-l1"><a class="reference internal" href="visibility.html">Visibilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation.html">Simulation and Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Analyzing the output files</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="population_analysis.html">Population analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="spectral_analysis.html">Spectral analysis of an astrophysical source</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The developer corner</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Building the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="#todo-list">Todo list</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#various">Various</a></li>
<li class="toctree-l2"><a class="reference internal" href="#masking-the-first-dataset-in-a-stacked-datasets">Masking the first dataset in a stacked Datasets</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SoHAPPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Building the documentation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/developer.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="building-the-documentation">
<h1>Building the documentation<a class="headerlink" href="#building-the-documentation" title="Permalink to this heading"></a></h1>
<p>Install Sphinx and the extensions.
Extensions should be installed separately. As an example the <cite>automodapi</cite>,
that creates an output superior to the autodoc standard package, has to be
installed (see here):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>conda install -c conda-forge sphinx
conda install -c conda-forge sphinx-automodapi
conda install –c conda-forge nbsphinx
conda install -c conda-forge recommonmark
conda install -c conda-forge numpydoc
conda install -c conda-forge sphinx_rtd_theme

make html
</pre></div>
</div>
</section>
<section id="todo-list">
<h1>Todo list<a class="headerlink" href="#todo-list" title="Permalink to this heading"></a></h1>
<section id="various">
<h2>Various<a class="headerlink" href="#various" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Stack the prompt with the afterglow</p></li>
<li><p>Can we suppress simulation for large S and B. yes, but how well ?</p></li>
<li><p>Inject Fermi data and IRF, compute response</p></li>
<li><p>Interpolate time counts within the time slices;</p></li>
<li><p>Use papermill to have the jupyter notebbok automatically run;</p></li>
<li><p>Use jupyter nbconvert to convert executed jupyter notebook into html files;</p></li>
</ul>
</section>
<section id="masking-the-first-dataset-in-a-stacked-datasets">
<h2>Masking the first dataset in a stacked Datasets<a class="headerlink" href="#masking-the-first-dataset-in-a-stacked-datasets" title="Permalink to this heading"></a></h2>
<p><em>From a Gammapy Slack conversation with &#64;adonath, Jan. 2021</em></p>
<p>By default the <code class="xref py py-obj docutils literal notranslate"><span class="pre">mask_safe</span></code> is not applied to a dataset so that it can be changed for different analysis with the same data.</p>
<p>When stacking a set of Dataset, all datasets except the first one are masked.
Up to gammapy 0.17 at least, in order to have the mask applied it had to be done “by hand” with the following function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_masked_dataset</span><span class="p">(</span><span class="n">ds0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a trick to get a masked datset from a dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ds0 : Dataset object</span>
<span class="sd">                The original complete unmasked dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        masked_dataset : Dataset object</span>
<span class="sd">                The original dataset with masking applied.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;dataset_tools/get_maked_dataset(ds) : masking disabled&quot;)</span>
        <span class="c1"># return ds0</span>

        <span class="n">e_true</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">aeff</span><span class="o">.</span><span class="n">energy</span><span class="o">.</span><span class="n">edges</span>
        <span class="n">e_reco</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span>
        <span class="n">region</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">region</span>
        <span class="n">masked_dataset</span> <span class="o">=</span> <span class="n">SpectrumDataset</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">e_true</span><span class="o">=</span><span class="n">e_true</span><span class="p">,</span> <span class="n">e_reco</span><span class="o">=</span><span class="n">e_reco</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">ds0</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span>
        <span class="n">masked_dataset</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">ds0</span><span class="o">.</span><span class="n">models</span>
        <span class="n">masked_dataset</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">ds0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">masked_dataset</span>
</pre></div>
</div>
<p>This functionnality is planned to be released soon as <code class="xref py py-func docutils literal notranslate"><span class="pre">to_masked()</span></code> in <cite>dataset/map.py</cite> and should replace the existing function.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="api/utilities.Dp.html" class="btn btn-neutral float-left" title="Dp" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Th. Stolarczyk.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>